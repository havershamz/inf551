<!DOCTYPE html><html lang="en"><head>    <meta charset="UTF-8">    <title>Project Gutenberg</title>    <link href="css/bootstrap-twitter.css" rel="stylesheet">    <link href="css/bootstrap-theme.css" rel="stylesheet">    <link href="css/bootstrap.css" rel="stylesheet">    <link href="css/style.css" rel="stylesheet"></head><body><div class="loading"></div><div id="loading" style="width: 100%; height: 100%; position: absolute; top: 0; left: 0;z-index:999;padding: 50px 200px;">    <div class="hero-unit" style="margin: 100px auto">        <h1 class="blink" style="font-size: 30px"><b>Project Gutenberg</b></h1>        <p>Thank you for using our product. We're glad you're with us.</p>        <div style="text-align: center;"><button class="btn btn-large" id="enter">Enter</button></div>    </div></div><div class="container-fluid">    <div class="row">        <div class="col-lg-4">            <div id="treeview12" class=""></div>            <iframe name="hiddenFrame" class="hide"></iframe>            <form action="http://54.215.194.165:8080/upload" method="post" enctype="multipart/form-data" target="hiddenFrame">                <div class="input-group">                    <div class="custom-file">                        <button type="button" class='btn btn-primary btn-default' >Choose File</button>                        <input type="file" multiple class="custom-file-input" id="inputGroupFile01"                               aria-describedby="inputGroupFileAddon01" name="file" style="opacity:0">                    </div>                    <div class="input-group-postpend">                        <button type="submit" class='btn btn-primary btn-default' >Upload File</button>                    </div>                </div>            </form>        </div>        <div class="col-lg-8">            <table id="dataTable" class="cell-border compact dt-head-center lead">                <thead>                <tr>                    <th>Title</th>                    <th>Authors</th>                    <th>Publisher</th>                    <th>TOC</th>                    <th>Keywords</th>                    <th>Download</th>                </tr>                </thead>            </table>        </div>    </div>    <div class="modal" id="tocModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">        <div class="modal-dialog" role="document">            <div class="modal-content">                <div class="modal-header">                    <h5 class="modal-title" id="tocModalLabel">Table of Content</h5>                </div>                <div class="modal-body">                    <pre></pre>                </div>                <div class="modal-footer">                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>                </div>            </div>        </div>    </div>    <div class="modal" id="kwdModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">        <div class="modal-dialog" role="document">            <div class="modal-content">                <div class="modal-header">                    <h5 class="modal-title" id="kwdModalLabel">Keywords</h5>                </div>                <div class="modal-body">                    <pre></pre>                </div>                <div class="modal-footer">                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>                </div>            </div>        </div>    </div></div></body><script src="js/jquery-3.3.1.min.js"></script><script src="js/bootstrap.js"></script><script src="https://www.gstatic.com/firebasejs/5.5.7/firebase-app.js"></script><script src="https://www.gstatic.com/firebasejs/5.5.7/firebase-database.js"></script><script src="https://sdk.amazonaws.com/js/aws-sdk-2.283.1.min.js"></script><script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script><script type="text/javascript" src="js/bootstrap-treeview.js"></script><script>    $(document).ready(function () {        _386 = { onePass: true, speedFactor: 1.25 };        $("#enter").click(function () {            $("#loading").attr("style", "display:none");        });        let data = [];        var table;        $('#tocModal').on('show.bs.modal', function (event) {            var button = $(event.relatedTarget); // Button that triggered the modal            var recipient = button.data('whatever'); // Extract info from data-* attributes            var modal = $(this);            console.log(modal.find('.modal-body p'));            modal.find('.model-body').css({                'overflow-y': 'scroll'            });            modal.find('.modal-body pre').text(recipient);        });        $('#kwdModal').on('show.bs.modal', function (event) {            var button = $(event.relatedTarget); // Button that triggered the modal            var recipient = button.data('whatever'); // Extract info from data-* attributes            var modal = $(this);            console.log(modal.find('.modal-body p'));            modal.find('.model-body').css({                'overflow-y': 'scroll'            });            modal.find('.modal-body pre').text(recipient);        });        const config = {            apiKey: "AIzaSyAOzwe-y75IffEhdpU9dnECf0iBvRGQVc0",            authDomain: "inf551-6b09f.firebaseapp.com",            databaseURL: "https://inf551-6b09f.firebaseio.com",            projectId: "inf551-6b09f",            storageBucket: "inf551-6b09f.appspot.com",            messagingSenderId: "797568039805"        };        firebase.initializeApp(config);        const Books = firebase.database().ref('/epub');        Books.once("value", function (snapshot) {            snapshot.forEach(function (row) {                data.push(row.val());            });            table = $('#dataTable').DataTable({                data: data,                'stripeClasses':['stripe1','stripe2'],                columns: [                    {data: 'title'},                    {data: 'creators'},                    {data: 'publisher'},                    {                        "className":'TOC',                        "data":null,                        "render": function(data, type, full, meta){                            let content = "";                            let count = 1;                            data['TOC'].forEach(function (chapter) {                                content += count.toString() + ": " + chapter['title'] + "\n";                                count += 1;                            });                            return "<button type=\"button\" class='btn btn-primary table-btn btn-default' data-toggle=\"modal\" data-target=\"#tocModal\" value=\"" + content + "\" data-whatever=\"" + content + "\">TOC</button>";                        }                    },                    {                        "className":'Keywords',                        "data":null,                        "render": function(data, type, full, meta){                            let content = "";                            data['kwd'].forEach(function (w) {                                content += w + "\n";                            });                            return "<button type=\"button\" class='btn btn-primary table-btn btn-default' data-toggle=\"modal\" data-target=\"#kwdModal\" data-whatever=\"" + content + "\">Keywords</button> <p style='display: none'>"+content+"</p>";                        }                    },                    {                        "className":'Link',                        "data":null,                        "render": function(data, type, full, meta){                            return "<a href='"+ data['link'].replace("/tmp/", "") + "'>Link</a>";                        }                    }                ],                "bLengthChange": false            });        });        const Authors = firebase.database().ref('/authors');        const Languages = firebase.database().ref('/languages');        const Publishers = firebase.database().ref('/publishers');        const frame = [            {                text: 'Authors',                href: '#authors',                nodes: []            },            {                text: 'Languages',                href: '#languages',                nodes: []            },            {                text: 'Publishers',                href: '#publishers',                nodes: []            }        ];        Array.prototype.sliceJoin = function(seperator, start, end){            if(!start) start = 0;            if(!end) end = this.length - 1;            end++;            return this.slice(start,end).join(seperator);        };        Authors.once('value').then(function (snapshot) {            snapshot.forEach(function (row) {                const author = row.key;                const count = row.val().length;                frame[0].nodes.push({                    text: 'Author-' + author,                    tags: [count.toString()]                })            });            frame[0].nodes.sort(function (a, b) {                return b.tags[0] - a.tags[0];            });        });        Languages.once('value').then(function (snapshot) {            snapshot.forEach(function (row) {                const lan = row.key;                const count = row.val().length;                frame[1].nodes.push({                    text: 'Lan-' + lan,                    tags: [count.toString()]                });            });            frame[1].nodes.sort(function (a, b) {                return b.tags[0] - a.tags[0];            });        });        Publishers.once('value').then(function (snapshot) {            snapshot.forEach(function (row) {                const publisher = row.key;                const count = row.val().length;                frame[2].nodes.push({                    text: 'Pub-' + publisher,                    tags: [count.toString()]                });            });            frame[2].nodes.sort(function (a, b) {                return b.tags[0] - a.tags[0];            });        }).then(function () {            frame[0].nodes = frame[0].nodes.slice(0, 5);            frame[1].nodes = frame[1].nodes.slice(0, 5);            frame[2].nodes = frame[2].nodes.slice(0, 5);            $('#treeview12').treeview({                showTags: true,                data: frame,                multiSelect: true,                onNodeSelected: function (event, node) {                    var constraint = node.text.split("-");                    var label = constraint[0];                    var value = constraint.sliceJoin('-', 1);                    if (!constraints[label].includes(value)) {                        constraints[label].push(value);                    }                    filter_constraints(constraints);                },                onNodeUnselected: function (event, node) {                    var constraint = node.text.split("-");                    var label = constraint[0];                    var value = constraint.sliceJoin('-', 1);                    if (constraints[label].includes(value)) {                        console.log(constraints[label][constraints[label].indexOf(value)]);                        var idx = constraints[label].indexOf(value);                        constraints[label].splice(idx, idx + 1);                    }                    filter_constraints(constraints);                }            });        });        const constraints = {            'Author': [],            'Lan': [],            'Pub': []        };        function filter_constraints() {            let rules = constraints;            let filtered_data = [];            data.forEach(function (d) {                if((rules["Author"].length > 0 && rules["Author"].includes(d['creators'][0])) || (rules["Lan"].length > 0 && rules["Lan"].includes(d['language'])) ||                    (rules["Pub"].length > 0 && rules["Pub"].includes(d['publisher']))){                    filtered_data.push(d);                } else if (rules["Author"].length === 0 && rules["Lan"].length ===  0 && rules["Pub"].length === 0){                    filtered_data.push(d);                }            });            table.clear();            table.rows.add(filtered_data);            table.draw();        }    });</script></html>